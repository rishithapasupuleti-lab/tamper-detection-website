<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tamper Detection â€” History</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>
<body>
  <header class="header">
    <div class="brand">Anti-Tamper Dashboard</div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="history.html">History</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
        <div>
          <h2>Tampering History</h2>
          <div class="small">Stored locally in your browser</div>
        </div>
        <div class="controls">
          <input id="searchInput" placeholder="Search..." />
          <select id="filterSelect">
            <option value="">All statuses</option>
            <option>OK</option>
            <option>WARNING</option>
            <option>TAMPER DETECTED</option>
          </select>
          <button id="exportBtn">Export CSV</button>
          <button id="clearBtn" class="ghost">Clear All</button>
        </div>
      </div>

      <table class="table">
        <thead><tr><th>Time</th><th>Status</th><th>Value</th><th>Note</th><th>Actions</th></tr></thead>
        <tbody id="historyTbody"></tbody>
      </table>
    </section>
    <div class="footer">You can mark records as resolved or delete them. Export creates a CSV of all saved records.</div>
  </main>

  <script>
    const tbody = document.getElementById("historyTbody");
    const searchInput = document.getElementById("searchInput");
    const filterSelect = document.getElementById("filterSelect");
    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");

    function refresh(){
      const opts = { q: searchInput.value.trim(), filterStatus: filterSelect.value || null, limit: 200 };
      app.renderHistoryTable(tbody, opts);
      app.attachTableActions(tbody);
    }

    searchInput.addEventListener("input", ()=> refresh());
    filterSelect.addEventListener("change", ()=> refresh());
    exportBtn.addEventListener("click", ()=> app.exportCSV ? app.exportCSV() : alert("No export function"));
    clearBtn.addEventListener("click", ()=>{
      if(!confirm("Clear all records? This cannot be undone.")) return;
      localStorage.removeItem("tamper_history_v1");
      refresh();
      document.dispatchEvent(new CustomEvent("historyChanged"));
    });

    document.addEventListener("historyChanged", ()=> refresh());
    // initial
    refresh();
  </script>
</body>
</html>